<script type="text/javascript">
    RED.nodes.registerType('visual-path-transition', {
        category: 'SD SmartHouse',
        icon: "batch.png",
        color: "#80bfff",
        inputs: 1,
        outputs: 1,
        defaults: {
            name:               { value: "", required: true },

            spawnVertexFrom:    { value: "", required: true },
            discardVertexAt:    { value: "", required: true },

            graphVertices:      { value: "", required: true },
        },

        label: function() {
            return this.name || "<unnamed>"
        },

        oneditprepare: function () {
            var that = this;
            this.editor = RED.editor.createEditor({
                id: 'node-input-graphVertices-editor',
                mode: 'ace/mode/markdown',
                value: $("#node-input-graphVertices").val()
            });
            this.editor.focus();
        },
        oneditsave: function () {
            $("#node-input-graphVertices").val(this.editor.getValue());
            this.editor.destroy();
            delete this.editor;
        },
        oneditcancel: function () {
            this.editor.destroy();
            delete this.editor;
        },
        oneditresize: function (size) {
            this.resize();
            this.editor.resize();
        },
    });
</script>

<script type="text/x-red" data-template-name="visual-path-transition">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="name">
    </div>
    <br>

    <div class="form-row">
        <label for="node-input-spawnVertexFrom"><i class="fa fa-sign-out"></i> Spawning vertex</label>
        <input type="text" id="node-input-spawnVertexFrom" placeholder="spawn from">
    </div>
    <br>

    <div class="form-row">
        <label for="node-input-discardVertexAt"><i class="fa fa-sign-in"></i> Discard vertex at</label>
        <input type="text" id="node-input-discardVertexAt" placeholder="discard vertex at">
    </div>
    <br>    

    <div class="form-row" style="margin-bottom: 0px;">
        <label for="node-input-graphVertices" style="width: 100% !important;"><i class="fa fa-link"></i> Graph vertices and weights:</label>
        <input type="hidden" id="node-input-graphVertices" autofocus="autofocus">
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height:500px; min-height:250px;" class="node-text-editor" id="node-input-graphVertices-editor"></div>
    </div>
</script>

<script type="text/x-red" data-help-name="visual-path-transition">
    <p>Visual effect of path transition</p>

    <p style="padding-top:10px"><b>Graph definition format</b>:</p>
    Regexp is used to parse the graph:<br>
    <small><code>
        (\d+)\s*([-><]+)\s*(\d+)\s*(W\((\d+)\)){0,1}$
    </code></small>
    <br>
    <i>Example of graph definition:</i><br>
    <small>
        <div style="margin-left:15px">
            <div>1   -   2    W(12)</div>
            <div>2   -   3    W(10)</div>
            <div>1   -   3    W(12)</div>
        </div>
        <code>1&harr;2&harr;3&crarr;</code>
    </small>

    <ul>
        <li><code>edge</code> may be defined as [-,-&gt;,&lt;-&gt;]</li>
            <small>
                <div style="margin-left:15px">
                    <i>
                        <div><code>&mdash;</code> - edge for not oriented graph</div>
                        <div><code>&rarr;</code> - l-value linked with r-value</div>
                        <div><code>&harr;</code> - bi-directional edge</div>
                    </i>
                </div>
            </small>        
        <li><code>W(..)</code> weight. <i>optional</i></li>
    </ul>
    <br>
    <br>

    <p style="padding-top:10px"><b>Output</b>:</p>
    <ul>
        <li><code>msg.payload.vertices</code> - array of array of vertices of steps to transit to finish.</li>
        <li><code>msg.payload.assembled</code> - array of assembled values of steps to transit to finish.</li>
    </ul>
</script>
